<UserControl
    x:Class="LabelVal.LabelBuilder.Views.DisplayEditorView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:clr="clr-namespace:System;assembly=netstandard"
    xmlns:componentmodel="clr-namespace:System.ComponentModel;assembly=WindowsBase"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:extensions="clr-namespace:LabelVal.LabelBuilder.Extensions"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:jas="clr-namespace:WPF.JoshSmith.Controls;assembly=WPF.JoshSmith.Controls.DragCanvas"
    xmlns:local="clr-namespace:LabelVal.LabelBuilder.Views"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:viewModels="clr-namespace:LabelVal.LabelBuilder.ViewModels"
    d:DataContext="{d:DesignInstance Type=viewModels:DisplayEditorViewModel}"
    d:Height="630"
    d:Width="691"
    mc:Ignorable="d">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Templates/SharedButtonStyles.xaml" />
                <ResourceDictionary Source="/LabelBuilder/Templates/LabelBuilderSectionContainerStyle.xaml" />
                <ResourceDictionary Source="/LabelBuilder/Templates/LabelBuilderSectionExpanderStyle.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <Style x:Key="HorizontalDividerBorder" TargetType="{x:Type Border}">
                <Setter Property="Background" Value="{DynamicResource MaterialDesignDivider}" />
                <Setter Property="Height" Value="1" />
                <Setter Property="HorizontalAlignment" Value="Stretch" />
                <Setter Property="UseLayoutRounding" Value="True" />
            </Style>

            <CollectionViewSource x:Key="BarcodeEntries" Source="{Binding BarcodeEntities}">
                <CollectionViewSource.SortDescriptions>
                    <componentmodel:SortDescription Direction="Ascending" PropertyName="ParentDir" />

                </CollectionViewSource.SortDescriptions>
                <CollectionViewSource.GroupDescriptions>
                    <PropertyGroupDescription PropertyName="ParentDir" />
                </CollectionViewSource.GroupDescriptions>
            </CollectionViewSource>

            <CollectionViewSource
                x:Key="DisplayBarcodeEntries"
                IsLiveSortingRequested="True"
                Source="{Binding SelectedDisplay.BarcodeEntities}">
                <CollectionViewSource.LiveSortingProperties>
                    <clr:String>Position.Top</clr:String>
                </CollectionViewSource.LiveSortingProperties>
                <CollectionViewSource.SortDescriptions>
                    <componentmodel:SortDescription Direction="Ascending" PropertyName="Position.Top" />
                </CollectionViewSource.SortDescriptions>
            </CollectionViewSource>

            <Style
                x:Key="ToolbarButtonBase"
                BasedOn="{StaticResource MahApps.Styles.Button.Hamburger}"
                TargetType="Button">
                <Setter Property="Margin" Value="3,1" />
                <Setter Property="Padding" Value="0" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Foreground" Value="{DynamicResource MahApps.HamburgerMenu.Pane.Foreground}" />
            </Style>
        </ResourceDictionary>



    </UserControl.Resources>


    <md:DrawerHost x:Name="drwSettings" VerticalAlignment="Stretch">

        <md:DrawerHost.TopDrawerContent>

            <StackPanel Orientation="Horizontal">
                <!--<StackPanel.LayoutTransform>
                    <ScaleTransform ScaleX="1.2" ScaleY="1.2" />
                </StackPanel.LayoutTransform>
                <StackPanel>
                    <ComboBox
                        HorizontalContentAlignment="Center"
                        md:HintAssist.Hint="Listen IPv4 Address"
                        md:TextFieldAssist.UnderlineCornerRadius="10"
                        BorderThickness="0"
                        IsEditable="True"
                        IsTextSearchEnabled="True"
                        ItemsSource="{Binding IPAddresses}"
                        Style="{StaticResource MaterialDesignFloatingHintComboBox}">
                        <ComboBox.Text>
                            <Binding
                                Mode="TwoWay"
                                Path="DPS_ListenIPAddress"
                                UpdateSourceTrigger="PropertyChanged">
                                <Binding.ValidationRules>
                                    <validation:IPAddressValidationRule ValidatesOnTargetUpdated="True" />
                                </Binding.ValidationRules>
                            </Binding>
                        </ComboBox.Text>
                    </ComboBox>
                </StackPanel>

                <StackPanel>
                    <TextBox
                        HorizontalContentAlignment="Center"
                        md:HintAssist.Hint="Listen Port"
                        md:TextFieldAssist.UnderlineCornerRadius="10"
                        BorderThickness="0"
                        Style="{StaticResource MaterialDesignFloatingHintTextBox}">
                        <TextBox.Text>
                            <Binding Path="DPS_ListenPort" UpdateSourceTrigger="PropertyChanged">
                                <Binding.ValidationRules>
                                    <validation:PortNumberValidationRule ValidatesOnTargetUpdated="True" />
                                </Binding.ValidationRules>
                            </Binding>
                        </TextBox.Text>
                    </TextBox>
                </StackPanel>-->

            </StackPanel>
        </md:DrawerHost.TopDrawerContent>

        <md:DrawerHost VerticalAlignment="Stretch" OpenMode="Standard">
            <md:DrawerHost.Style>
                <Style BasedOn="{StaticResource {x:Type md:DrawerHost}}" TargetType="md:DrawerHost">
                    <Setter Property="IsBottomDrawerOpen" Value="True" />
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding StatusMessage}" Value="{x:Null}">
                            <Setter Property="IsBottomDrawerOpen" Value="False" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </md:DrawerHost.Style>

            <md:DrawerHost.BottomDrawerContent>
                <StackPanel Orientation="Horizontal">
                    <Button
                        x:Name="btnAckMsg"
                        Width="20"
                        Height="20"
                        Margin="3,0,8,0"
                        HorizontalAlignment="Left"
                        Click="btnAckMsg_Click"
                        Style="{StaticResource MaterialDesignFloatingActionMiniDarkButton}"
                        ToolTip="Acknowlegde">

                        <iconPacks:Material
                            Width="12"
                            Height="12"
                            Kind="ThumbUp" />
                    </Button>
                    <TextBlock
                        Margin="3"
                        Text="{Binding StatusMessage}"
                        TextWrapping="Wrap" />
                </StackPanel>
            </md:DrawerHost.BottomDrawerContent>

            <DockPanel>
                <!--  Barcode Thumbnail List  -->
                <GroupBox Margin="0,5" Style="{StaticResource LabelBuilderSectionContainerStyle}">

                    <GroupBox.Header>
                        <StackPanel Orientation="Horizontal">

                            <TextBlock Text="Barcode Images" />

                            <Button Command="{Binding LoadBarcodeLibraryFilesCommand}" Style="{StaticResource ToolbarButtonBase}">
                                <iconPacks:Modern Kind="Refresh" />
                            </Button>
                        </StackPanel>

                    </GroupBox.Header>

                    <md:Card Padding="2" Background="{DynamicResource MahApps.Brushes.Control.Background}">

                        <ScrollViewer VerticalScrollBarVisibility="Auto">

                            <ItemsControl Grid.Row="1" ItemsSource="{Binding Source={StaticResource ResourceKey=BarcodeEntries}}">
                                <ItemsControl.GroupStyle>
                                    <GroupStyle>
                                        <GroupStyle.ContainerStyle>
                                            <Style TargetType="{x:Type GroupItem}">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="{x:Type GroupItem}">
                                                            <Expander Margin="1">
                                                                <Expander.Style>
                                                                    <Style BasedOn="{StaticResource {x:Type Expander}}" TargetType="{x:Type Expander}">
                                                                        <Setter Property="BorderBrush" Value="Orange" />
                                                                        <Setter Property="Margin" Value="5" />
                                                                    </Style>
                                                                </Expander.Style>
                                                                <Expander.Header>
                                                                    <StackPanel Orientation="Horizontal">
                                                                        <TextBlock Margin="5,2,5,2" Text="{Binding Name}" />
                                                                        <!--<TextBlock Text=":" Margin="0 2 5 2"/>
                                                            <TextBlock Text="{Binding ItemCount}" Margin="0 2 0 2"/>-->
                                                                    </StackPanel>
                                                                </Expander.Header>

                                                                <ItemsPresenter />

                                                            </Expander>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </GroupStyle.ContainerStyle>
                                    </GroupStyle>
                                </ItemsControl.GroupStyle>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">

                                            <Button
                                                Margin="0"
                                                BorderThickness="0"
                                                Command="{Binding Path=DataContext.AddBarcodeToCanvasCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource MaterialDesignFlatButton}">
                                                <iconPacks:Modern
                                                    Width="16"
                                                    Height="16"
                                                    Kind="Add" />
                                            </Button>

                                            <StackPanel>
                                                <TextBlock Text="{Binding FileName}" />
                                                <Image Source="{Binding ThumbPath}" />
                                            </StackPanel>

                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </md:Card>
                </GroupBox>
                <!--  Display List  -->
                <GroupBox Margin="0,5" Style="{StaticResource LabelBuilderSectionContainerStyle}">

                    <GroupBox.Header>
                        <DockPanel>

                            <TextBlock Text="Display List" />

                            <Button Command="{Binding NewDisplayEntityCommand}" Style="{StaticResource ToolbarButtonBase}">
                                <iconPacks:Modern Kind="Add" />
                            </Button>

                            <Button Command="{Binding SaveDisplayEntitiesCommand}" Style="{StaticResource ToolbarButtonBase}">
                                <iconPacks:Modern Kind="Save" />
                            </Button>

                        </DockPanel>
                    </GroupBox.Header>

                    <md:Card Padding="2" Background="{DynamicResource MahApps.Brushes.Control.Background}">

                        <ListBox ItemsSource="{Binding DisplayEntities}" SelectedItem="{Binding SelectedDisplay}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <md:Card Margin="-5" Background="{DynamicResource MahApps.Brushes.Accent4}">
                                        <md:DrawerHost VerticalAlignment="Stretch">
                                            <md:DrawerHost.LeftDrawerContent>
                                                <StackPanel Orientation="Horizontal">

                                                    <TextBox Width="160" />

                                                    <StackPanel>
                                                        <Button
                                                            Width="20"
                                                            Height="20"
                                                            Margin="1"
                                                            HorizontalAlignment="Right"
                                                            VerticalAlignment="Center"
                                                            Click="btnRenameDisplayClose_Click"
                                                            Style="{StaticResource MaterialDesignFloatingActionMiniDarkButton}"
                                                            ToolTip="Close">

                                                            <iconPacks:Material
                                                                Width="12"
                                                                Height="12"
                                                                Kind="Close" />
                                                        </Button>
                                                        <Button
                                                            Width="20"
                                                            Height="20"
                                                            Margin="1"
                                                            HorizontalAlignment="Right"
                                                            VerticalAlignment="Center"
                                                            Click="btnRenameDisplayAccept_Click"
                                                            Style="{StaticResource MaterialDesignFloatingActionMiniDarkButton}"
                                                            ToolTip="Accept">

                                                            <iconPacks:Material
                                                                Width="12"
                                                                Height="12"
                                                                Kind="Check" />
                                                        </Button>
                                                    </StackPanel>

                                                </StackPanel>

                                            </md:DrawerHost.LeftDrawerContent>

                                            <DockPanel Width="180">
                                                <StackPanel>
                                                    <StackPanel Orientation="Horizontal">
                                                        <Button
                                                            Width="20"
                                                            Height="20"
                                                            Margin="1"
                                                            HorizontalAlignment="Left"
                                                            VerticalAlignment="Top"
                                                            Click="btnRenameDisplayOpen_Click"
                                                            Style="{StaticResource MaterialDesignFloatingActionMiniDarkButton}"
                                                            ToolTip="Rename">

                                                            <iconPacks:BoxIcons
                                                                Width="12"
                                                                Height="12"
                                                                Kind="RegularRename" />
                                                        </Button>

                                                        <TextBlock Margin="3" Text="{Binding Name}" />
                                                    </StackPanel>

                                                    <TextBlock Margin="3" Text="{Binding BarcodeEntities.Count}" />
                                                </StackPanel>

                                                <Button
                                                    Width="20"
                                                    Height="20"
                                                    Margin="5"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Bottom"
                                                    Command="{Binding Path=DataContext.RemoveDisplayCanvasCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                    CommandParameter="{Binding}"
                                                    Style="{StaticResource MaterialDesignFloatingActionMiniDarkButton}"
                                                    ToolTip="Remove from display?">

                                                    <iconPacks:Modern
                                                        Width="12"
                                                        Height="12"
                                                        Kind="Delete" />
                                                </Button>

                                            </DockPanel>
                                        </md:DrawerHost>
                                    </md:Card>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                    </md:Card>
                </GroupBox>

                <ScrollViewer VerticalScrollBarVisibility="Auto">

                    <!--  Display Canvas  -->
                    <GroupBox Margin="0,5" Style="{StaticResource LabelBuilderSectionContainerStyle}">

                        <GroupBox.Header>
                            <DockPanel>
                                <TextBlock Text="{Binding SelectedDisplay.Name}" />
                            </DockPanel>
                        </GroupBox.Header>

                        <md:Card Padding="2" Background="{DynamicResource MahApps.Brushes.Control.Background}">
                            <StackPanel Orientation="Horizontal">

                                <!--  Canvas Barcodes List  -->
                                <GroupBox
                                    Margin="3"
                                    Padding="3"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    md:ColorZoneAssist.Background="{DynamicResource MahApps.Brushes.Accent4}"
                                    md:ColorZoneAssist.Foreground="{DynamicResource MahApps.Brushes.Foreground}"
                                    md:ColorZoneAssist.Mode="Custom"
                                    BorderThickness="0"
                                    Style="{StaticResource MaterialDesignCardGroupBox}">

                                    <GroupBox.Header>
                                        <md:Card
                                            Padding="1"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Bottom"
                                            Background="{DynamicResource MahApps.Brushes.Control.Background}">
                                            <TextBlock FontSize="{DynamicResource MahApps.Font.Size.ContextMenu}" Text="Barcode List" />
                                        </md:Card>
                                    </GroupBox.Header>

                                    <md:Card Padding="2" Background="{DynamicResource MahApps.Brushes.Control.Background}">

                                        <ListBox
                                            MaxHeight="{Binding SelectedDisplay.Size}"
                                            ItemsSource="{Binding Source={StaticResource ResourceKey=DisplayBarcodeEntries}}"
                                            SelectedItem="{Binding SelectedBarcodeEntity}">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <md:Card
                                                        Width="185"
                                                        Margin="-5"
                                                        Background="{DynamicResource MahApps.Brushes.Accent4}">
                                                        <DockPanel>

                                                            <StackPanel DockPanel.Dock="Top">
                                                                <TextBlock
                                                                    Margin="3,3"
                                                                    Text="{Binding ParentDir}"
                                                                    TextWrapping="Wrap" />
                                                                <TextBlock
                                                                    Margin="3,0"
                                                                    HorizontalAlignment="Center"
                                                                    Text="{Binding FileName}"
                                                                    TextWrapping="Wrap" />
                                                            </StackPanel>

                                                            <mah:NumericUpDown
                                                                Margin="3"
                                                                Padding="3"
                                                                md:HintAssist.FloatingHintHorizontalAlignment="Right"
                                                                md:HintAssist.Hint="Scale"
                                                                md:HintAssist.IsFloating="True"
                                                                md:TextFieldAssist.SuffixText="%"
                                                                Background="{DynamicResource MahApps.Brushes.Background}"
                                                                BorderThickness="0"
                                                                Interval="0.1"
                                                                Maximum="5.0"
                                                                Minimum="0.1"
                                                                StringFormat="F1"
                                                                Value="{Binding Position.Scale}" />

                                                            <Button
                                                                Width="20"
                                                                Height="20"
                                                                Margin="5"
                                                                HorizontalAlignment="Right"
                                                                VerticalAlignment="Bottom"
                                                                Command="{Binding Path=DataContext.RemoveBarcodeFromCanvasCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                                CommandParameter="{Binding}"
                                                                Style="{StaticResource MaterialDesignFloatingActionMiniDarkButton}"
                                                                ToolTip="Remove from display?">

                                                                <iconPacks:Modern
                                                                    Width="12"
                                                                    Height="12"
                                                                    Kind="Delete" />
                                                            </Button>

                                                        </DockPanel>
                                                    </md:Card>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                    </md:Card>
                                </GroupBox>

                                <StackPanel>

                                    <!--  Display Canvas Menu  -->
                                    <StackPanel Orientation="Horizontal">

                                        <ToggleButton
                                            Width="32"
                                            Height="32"
                                            Margin="10,0"
                                            IsChecked="{Binding ShowBarcodeBorders}"
                                            Style="{StaticResource MaterialDesignFlatToggleButton}"
                                            ToolTip="Image Borders">
                                            <iconPacks:Modern
                                                Width="16"
                                                Height="16"
                                                Kind="BorderAll" />
                                        </ToggleButton>

                                        <TextBox
                                            Margin="3,0,3,3"
                                            md:HintAssist.Hint="Canvas Size"
                                            md:HintAssist.IsFloating="True"
                                            md:TextFieldAssist.SuffixText="px"
                                            Text="{Binding SelectedDisplay.Size}" />

                                    </StackPanel>

                                    <!--  Display Canvas  -->
                                    <ItemsControl x:Name="itcCanvas" ItemsSource="{Binding SelectedDisplay.BarcodeEntities}">

                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <jas:DragCanvas Width="{Binding DataContext.SelectedDisplay.Size, RelativeSource={RelativeSource AncestorType=ItemsControl}}" Height="{Binding DataContext.SelectedDisplay.Size, RelativeSource={RelativeSource AncestorType=ItemsControl}}">
                                                    <jas:DragCanvas.Style>
                                                        <Style TargetType="jas:DragCanvas">
                                                            <Setter Property="Background" Value="White" />
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding SelectedDisplay}" Value="{x:Null}">
                                                                    <Setter Property="Background" Value="{DynamicResource MahApps.Brushes.Background}" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </jas:DragCanvas.Style>
                                                </jas:DragCanvas>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>

                                        <ItemsControl.ItemContainerStyle>
                                            <Style TargetType="ContentPresenter">
                                                <Setter Property="Canvas.Left" Value="{Binding Position.Left, Mode=TwoWay}" />
                                                <Setter Property="Canvas.Top" Value="{Binding Position.Top, Mode=TwoWay}" />
                                                <Setter Property="Canvas.ZIndex" Value="{Binding Position.ZIndex, Mode=TwoWay}" />
                                                <Setter Property="RenderTransform">
                                                    <Setter.Value>
                                                        <ScaleTransform ScaleX="{Binding Position.Scale}" ScaleY="{Binding Position.Scale}" />
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ItemsControl.ItemContainerStyle>

                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>

                                                <Border BorderBrush="{DynamicResource MahApps.Brushes.Accent}">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="BorderThickness" Value="1" />
                                                            <Setter Property="Margin" Value="-1" />
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding DataContext.ShowBarcodeBorders, RelativeSource={RelativeSource AncestorType=ItemsControl}}" Value="False">
                                                                    <Setter Property="BorderThickness" Value="0" />
                                                                    <Setter Property="Margin" Value="0" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>

                                                    <Image PreviewMouseLeftButtonDown="Image_PreviewMouseLeftButtonDown" Source="{Binding Image}">

                                                        <Image.ContextMenu>
                                                            <ContextMenu Opened="ContextMenu_Opened">
                                                                <MenuItem
                                                                    x:Name="mniBringtoFront"
                                                                    Click="mniBringtoFront_Click"
                                                                    Header="Bring to Front" />
                                                                <MenuItem
                                                                    x:Name="mniSendToBack"
                                                                    Click="mniSendToBack_Click"
                                                                    DataContext="{Binding}"
                                                                    Header="Send to Back" />

                                                                <MenuItem Header="Scale">
                                                                    <MenuItem
                                                                        x:Name="mniScaleUp"
                                                                        Click="mniScaleUp_Click"
                                                                        DataContext="{Binding}"
                                                                        Header="10% Larger" />
                                                                    <MenuItem
                                                                        x:Name="mniScaleDown"
                                                                        Click="mniScaleDown_Click"
                                                                        DataContext="{Binding}"
                                                                        Header="10% Smaller" />
                                                                    <MenuItem
                                                                        x:Name="mniScaleReset"
                                                                        Click="mniScaleReset_Click"
                                                                        DataContext="{Binding}"
                                                                        Header="Reset" />
                                                                </MenuItem>

                                                            </ContextMenu>
                                                        </Image.ContextMenu>
                                                    </Image>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                </StackPanel>
                            </StackPanel>
                        </md:Card>
                    </GroupBox>

                </ScrollViewer>



            </DockPanel>
        </md:DrawerHost>
    </md:DrawerHost>
</UserControl>
