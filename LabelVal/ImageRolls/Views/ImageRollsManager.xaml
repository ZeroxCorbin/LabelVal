<!--
    This UserControl defines the view for managing "Image Rolls".
    Image Rolls are collections of images used for barcode verification testing.
    The view is split into two main sections:
    1. User Image Rolls: Editable collections of images created by the user.
    2. Fixed Image Rolls: Read-only, pre-defined collections of images.
    
    The UI uses MahApps.Metro and MaterialDesignInXAML for styling and controls.
-->
<UserControl
    x:Class="LabelVal.ImageRolls.Views.ImageRollsManager"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:barCommon="clr-namespace:BarcodeVerification.lib.Common;assembly=BarcodeVerification.lib"
    xmlns:componentmodel="clr-namespace:System.ComponentModel;assembly=WindowsBase"
    xmlns:converters="clr-namespace:LabelVal.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:data="clr-namespace:System.Windows.Data;assembly=PresentationFramework"
    xmlns:dialog="clr-namespace:MahApps.Metro.Controls.Dialogs;assembly=MahApps.Metro"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:imageRollEnums="clr-namespace:LabelVal.ImageRolls.ViewModels"
    xmlns:local="clr-namespace:LabelVal.ImageRolls.Views"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:viewModels="clr-namespace:LabelVal.ImageRolls.ViewModels"
    d:DataContext="{d:DesignInstance Type=viewModels:ImageRollsManager,
                                     IsDesignTimeCreatable=False}"
    dialog:DialogParticipation.Register="{Binding}"
    mc:Ignorable="d">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Templates/SharedButtonStyles.xaml" />
                <ResourceDictionary Source="Templates/ImageRollListItemTemplate.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!--  Base (leaf) style  -->
            <Style
                x:Key="AllImageRollsTreeViewItemStyle"
                BasedOn="{StaticResource MaterialDesignTreeViewItem}"
                TargetType="TreeViewItem">
                <Setter Property="IsExpanded" Value="False" />
                <Setter Property="Margin" Value="-12,1,0,1" />
                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Padding" Value="0" />
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="md:RippleAssist.Feedback" Value="{DynamicResource MahApps.Brushes.Accent}" />
                <EventSetter Event="Selected" Handler="LeafTreeViewItem_Selected" />
                <Setter Property="ItemsControl.ItemContainerStyleSelector" Value="{DynamicResource ImageRollsTreeViewItemStyleSelector}" />

                <Style.Triggers>
                    <!--  Hover (only when not selected)  -->
                    <MultiTrigger>
                        <MultiTrigger.Conditions>
                            <Condition Property="IsMouseOver" Value="True" />
                            <Condition Property="IsSelected" Value="False" />
                        </MultiTrigger.Conditions>
                        <Setter Property="Background">
                            <Setter.Value>
                                <SolidColorBrush Opacity="0.20" Color="{DynamicResource MahApps.Colors.Accent}" />
                            </Setter.Value>
                        </Setter>
                    </MultiTrigger>

                    <!--  Selected (focused)  -->
                    <MultiTrigger>
                        <MultiTrigger.Conditions>
                            <Condition Property="IsSelected" Value="True" />
                            <Condition Property="IsKeyboardFocusWithin" Value="True" />
                        </MultiTrigger.Conditions>
                        <Setter Property="Background">
                            <Setter.Value>
                                <SolidColorBrush Opacity="0.80" Color="{DynamicResource MahApps.Colors.Accent}" />
                            </Setter.Value>
                        </Setter>
                        <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.ThemeForeground}" />
                        <Setter Property="FontWeight" Value="SemiBold" />
                    </MultiTrigger>

                    <!--  Selected (inactive focus)  -->
                    <MultiTrigger>
                        <MultiTrigger.Conditions>
                            <Condition Property="IsSelected" Value="True" />
                            <Condition Property="IsKeyboardFocusWithin" Value="False" />
                        </MultiTrigger.Conditions>
                        <Setter Property="Background">
                            <Setter.Value>
                                <SolidColorBrush Opacity="0.60" Color="{DynamicResource MahApps.Colors.Accent}" />
                            </Setter.Value>
                        </Setter>
                        <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.ThemeForeground}" />
                        <Setter Property="FontWeight" Value="SemiBold" />
                    </MultiTrigger>
                </Style.Triggers>
            </Style>

            <!--  Group (non-selectable) style  -->
            <Style
                x:Key="GroupTreeViewItemStyle"
                BasedOn="{StaticResource AllImageRollsTreeViewItemStyle}"
                TargetType="TreeViewItem">
                <Setter Property="Focusable" Value="False" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Padding" Value="0,1,0,1" />
                <Setter Property="IsHitTestVisible" Value="True" />
                <Setter Property="Background" Value="Transparent" />
                <EventSetter Event="PreviewMouseLeftButtonDown" Handler="GroupTreeViewItem_PreviewMouseLeftButtonDown" />
                <EventSetter Event="Selected" Handler="GroupTreeViewItem_Selected" />
                <Style.Triggers>
                    <Trigger Property="local:ImageRollsManager.IsAncestorOfSelected" Value="True">
                        <Setter Property="Background">
                            <Setter.Value>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Offset="0" Color="{DynamicResource MahApps.Colors.Accent}" />
                                    <GradientStop Offset="1" Color="{DynamicResource MahApps.Colors.Accent4}" />
                                </LinearGradientBrush>
                            </Setter.Value>
                        </Setter>
                        <Setter Property="BorderThickness" Value="1" />
                        <Setter Property="BorderBrush" Value="{DynamicResource MahApps.Brushes.Accent3}" />
                        <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.ThemeForeground}" />
                        <Setter Property="FontWeight" Value="SemiBold" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!--  Leaf template for ImageRoll (re-uses existing list item template)  -->
            <DataTemplate DataType="{x:Type viewModels:ImageRoll}">
                <ContentPresenter
                    Margin="3"
                    Content="{Binding}"
                    ContentTemplate="{StaticResource ImageRollListItemTemplate}" />
            </DataTemplate>

            <!--  Single style selector (do NOT duplicate)  -->
            <local:ImageRollsTreeViewItemStyleSelector
                x:Key="ImageRollsTreeViewItemStyleSelector"
                GroupStyle="{StaticResource GroupTreeViewItemStyle}"
                ItemStyle="{StaticResource AllImageRollsTreeViewItemStyle}" />

            <!--  Added IsLiveSortingRequested / IsLiveGroupingRequested and Live*Properties  -->
            <CollectionViewSource
                x:Key="AllImageRolls"
                IsLiveGroupingRequested="True"
                IsLiveSortingRequested="True"
                Source="{Binding AllImageRolls}">
                <CollectionViewSource.SortDescriptions>
                    <componentmodel:SortDescription Direction="Ascending" PropertyName="RollType" />
                    <componentmodel:SortDescription Direction="Ascending" PropertyName="SelectedApplicationStandard" />
                    <componentmodel:SortDescription Direction="Ascending" PropertyName="SelectedGradingStandard" />
                    <componentmodel:SortDescription Direction="Ascending" PropertyName="GS1TableNumber" />
                    <componentmodel:SortDescription Direction="Ascending" PropertyName="Name" />
                </CollectionViewSource.SortDescriptions>
                <CollectionViewSource.GroupDescriptions>
                    <PropertyGroupDescription PropertyName="RollType" />
                    <PropertyGroupDescription PropertyName="StandardGroup" />
                </CollectionViewSource.GroupDescriptions>

                <!--  Live sorting/grouping property lists  -->
                <CollectionViewSource.LiveSortingProperties>
                    <sys:String>RollType</sys:String>
                    <sys:String>SelectedApplicationStandard</sys:String>
                    <sys:String>SelectedGradingStandard</sys:String>
                    <sys:String>GS1TableNumber</sys:String>
                    <sys:String>Name</sys:String>
                </CollectionViewSource.LiveSortingProperties>
                <CollectionViewSource.LiveGroupingProperties>
                    <sys:String>RollType</sys:String>
                    <sys:String>StandardGroup</sys:String>
                </CollectionViewSource.LiveGroupingProperties>
            </CollectionViewSource>

        </ResourceDictionary>
    </UserControl.Resources>

    <!--  Combined (All Image Rolls) Section  -->
    <DockPanel
        Grid.RowSpan="2"
        Grid.Column="1"
        Margin="3">

        <md:Card
            Margin="3,3,0,0"
            Background="{DynamicResource MahApps.HamburgerMenu.Pane.Background}"
            DockPanel.Dock="Top"
            Foreground="{DynamicResource MahApps.HamburgerMenu.Pane.Foreground}">
            <DockPanel>

                <!--  Left icon stack (unchanged replicated pattern)  -->
                <Grid Width="47">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <DockPanel Grid.Row="0" Background="{DynamicResource ImageRoll_Brush_Active50}">
                        <iconPacks:PackIconMaterial
                            Width="32"
                            Height="32"
                            Padding="3"
                            HorizontalAlignment="Center"
                            Kind="FilmstripBoxMultiple" />
                    </DockPanel>

                    <Grid Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Button
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            BorderThickness="0"
                            Click="btnOpenImageRollsLocation"
                            Style="{StaticResource MahApps.Styles.DropDownButton.Button.WindowCommands}"
                            ToolTip="Open the image roll database location.">
                            <iconPacks:Modern
                                Width="22"
                                Height="22"
                                Kind="FolderOpen" />
                        </Button>

                        <!--  Dropdown for managing database sources.  -->
                        <mah:DropDownButton
                            Grid.Row="1"
                            BorderThickness="0"
                            ButtonStyle="{StaticResource MahApps.Styles.DropDownButton.Button.WindowCommands}"
                            ItemsSource="{Binding FileRoot.Children}"
                            ToolTip="Control which databases are loaded or ignored.">
                            <mah:DropDownButton.ItemTemplate>
                                <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                    <DockPanel>
                                        <CheckBox IsChecked="{Binding IsSelected}" />
                                        <TextBlock Text="{Binding Name}" />
                                    </DockPanel>
                                </HierarchicalDataTemplate>
                            </mah:DropDownButton.ItemTemplate>

                            <mah:DropDownButton.Icon>
                                <iconPacks:PackIconMaterial Kind="Database" />
                            </mah:DropDownButton.Icon>
                        </mah:DropDownButton>
                    </Grid>
                </Grid>

                <DockPanel
                    Height="32"
                    HorizontalAlignment="Stretch"
                    DockPanel.Dock="Top">
                    <DockPanel.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Offset="0" Color="{DynamicResource ImageRoll_Color_Active50}" />
                            <GradientStop Offset="1" Color="{DynamicResource MahApps.Colors.HamburgerMenu}" />
                        </LinearGradientBrush>
                    </DockPanel.Background>

                    <TextBlock
                        Margin="6,0,6,3"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Center"
                        DockPanel.Dock="Top"
                        Style="{StaticResource MahApps.Styles.TextBlock.HamburgerMenuHeader}"
                        Text="All Image Rolls" />

                </DockPanel>

                <!--  Right side toolbar area retained (buttons already tied to New/Edit logic)  -->
                <ToolBarTray>
                    <ToolBar Padding="0,3" ToolBarTray.IsLocked="True">
                        <Button Command="{Binding AddCommand}" ToolTip="Add a new Image Roll to the current database.">
                            <Button.Style>
                                <Style BasedOn="{StaticResource ToolBarButton}" TargetType="{x:Type Button}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding NewImageRoll, Converter={StaticResource IsNullOrEmpty}}" Value="True">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            <DockPanel>
                                <TextBlock
                                    Margin="0,0,0,3"
                                    HorizontalAlignment="Center"
                                    DockPanel.Dock="Top"
                                    Text="New"
                                    Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                <iconPacks:PackIconMaterial
                                    Width="24"
                                    Height="24"
                                    HorizontalAlignment="Center"
                                    Kind="Plus" />
                            </DockPanel>
                        </Button>

                        <Button Command="{Binding EditCommand}" ToolTip="Edit the selected Image Roll.">
                            <Button.Style>
                                <Style BasedOn="{StaticResource ToolBarButton}" TargetType="{x:Type Button}">
                                    <Setter Property="Visibility" Value="Visible" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ActiveImageRoll, Converter={StaticResource IsNullOrEmpty}}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed" />
                                        </DataTrigger>

                                        <DataTrigger Binding="{Binding NewImageRoll, Converter={StaticResource IsNullOrEmpty}}" Value="False">
                                            <Setter Property="Visibility" Value="Collapsed" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding ActiveImageRoll.RollType}" Value="{x:Static imageRollEnums:ImageRollTypes.Directory}">
                                            <Setter Property="Visibility" Value="Collapsed" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            <DockPanel>
                                <TextBlock
                                    Margin="0,0,0,3"
                                    HorizontalAlignment="Center"
                                    DockPanel.Dock="Top"
                                    Text="Edit"
                                    Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                <iconPacks:PackIconMaterial
                                    Width="24"
                                    Height="24"
                                    HorizontalAlignment="Center"
                                    Kind="SquareEditOutline" />
                            </DockPanel>
                        </Button>

                        <Button Command="{Binding SaveCommand}" ToolTip="Save Image Roll">
                            <Button.Style>
                                <Style BasedOn="{StaticResource ToolBarButton}" TargetType="{x:Type Button}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding NewImageRoll, Converter={StaticResource IsNullOrEmpty}}" Value="False">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding NewImageRoll.HasErrors}" Value="True">
                                            <Setter Property="IsEnabled" Value="False" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            <DockPanel>
                                <TextBlock
                                    Margin="0,0,0,3"
                                    HorizontalAlignment="Center"
                                    DockPanel.Dock="Top"
                                    Text="Save"
                                    Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                <iconPacks:PackIconMaterial
                                    Width="24"
                                    Height="24"
                                    HorizontalAlignment="Center"
                                    Kind="ContentSave" />
                            </DockPanel>
                        </Button>

                        <Button Command="{Binding CancelCommand}" ToolTip="Cancel">
                            <Button.Style>
                                <Style BasedOn="{StaticResource ToolBarButton}" TargetType="{x:Type Button}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding NewImageRoll, Converter={StaticResource IsNullOrEmpty}}" Value="False">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            <DockPanel>
                                <TextBlock
                                    Margin="0,0,0,3"
                                    HorizontalAlignment="Center"
                                    DockPanel.Dock="Top"
                                    Text="Cancel"
                                    Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                <iconPacks:PackIconMaterial
                                    Width="24"
                                    Height="24"
                                    HorizontalAlignment="Center"
                                    Kind="Cancel" />
                            </DockPanel>
                        </Button>

                        <Button Command="{Binding DeleteCommand}" ToolTip="Delete">
                            <Button.Style>
                                <Style BasedOn="{StaticResource ToolBarButton}" TargetType="{x:Type Button}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding NewImageRoll, Converter={StaticResource IsNullOrEmpty}}" Value="False" />
                                                <Condition Binding="{Binding NewImageRoll.IsSaved}" Value="True" />
                                            </MultiDataTrigger.Conditions>
                                            <MultiDataTrigger.Setters>
                                                <Setter Property="Visibility" Value="Visible" />
                                            </MultiDataTrigger.Setters>
                                        </MultiDataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            <DockPanel>
                                <TextBlock
                                    Margin="0,0,0,3"
                                    HorizontalAlignment="Center"
                                    DockPanel.Dock="Top"
                                    Text="Delete"
                                    Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                <iconPacks:PackIconMaterial
                                    Width="24"
                                    Height="24"
                                    HorizontalAlignment="Center"
                                    Kind="Delete" />
                            </DockPanel>
                        </Button>
                    </ToolBar>
                </ToolBarTray>

                <DockPanel Background="{DynamicResource MaterialDesign.Brush.ToolBar.Background}">
                    <StackPanel
                        Margin="0,0,6,0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center">
                        <TextBlock
                            Margin="0,0,0,2"
                            HorizontalAlignment="Center"
                            DockPanel.Dock="Top"
                            FontSize="10"
                            FontWeight="DemiBold"
                            Foreground="{DynamicResource MahApps.Brushes.Text}"
                            Text="Text Align"
                            Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />
                        <ToggleButton
                            HorizontalAlignment="Center"
                            md:ToggleButtonAssist.OnContent="{iconPacks:Modern Kind=AlignRight}"
                            Content=""
                            IsChecked="{Binding RightAlignOverflow}"
                            ToolTip="Toggle name aligned left or right.">
                            <ToggleButton.LayoutTransform>
                                <ScaleTransform ScaleX="0.8" ScaleY="0.8" />
                            </ToggleButton.LayoutTransform>
                        </ToggleButton>
                    </StackPanel>
                </DockPanel>

            </DockPanel>
        </md:Card>

        <DockPanel DockPanel.Dock="Top">
            <Border Style="{StaticResource groupLeft}">
                <Border.Background>
                    <LinearGradientBrush StartPoint="1,1" EndPoint="0.2,0.2">
                        <GradientStop Offset="0" Color="{DynamicResource ImageRoll_Color_Active}" />
                        <GradientStop Offset="1" Color="{DynamicResource MahApps.Colors.ThemeBackground}" />
                    </LinearGradientBrush>
                </Border.Background>
            </Border>
            <Border Style="{StaticResource groupBottom}">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0.8,0.8">
                        <GradientStop Offset="0" Color="{DynamicResource ImageRoll_Color_Active}" />
                        <GradientStop Offset="1" Color="{DynamicResource MahApps.Colors.ThemeBackground}" />
                    </LinearGradientBrush>
                </Border.Background>
            </Border>

            <!--
                DrawerHost that contains the editing UI for an image roll.
                It appears from the top when a new image roll is being created or an existing one is edited.
            -->
            <md:DrawerHost
                x:Name="DrwEditImageRollAll"
                OpenMode="Modal"
                TopDrawerCloseOnClickAway="False">
                <md:DrawerHost.Style>
                    <Style TargetType="md:DrawerHost">
                        <Setter Property="IsTopDrawerOpen" Value="False" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding NewImageRoll, Converter={StaticResource IsNullOrEmpty}}" Value="False">
                                <Setter Property="IsTopDrawerOpen" Value="True" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </md:DrawerHost.Style>

                <md:DrawerHost.TopDrawerContent>
                    <local:ImageRollEntryEdit DataContext="{Binding NewImageRoll}" Visibility="{Binding ., Converter={StaticResource IsNullOrEmptyVisibility}}" />
                </md:DrawerHost.TopDrawerContent>

                <!--  New TreeView replacing previous TabCtlAllIr  -->
                <TreeView
                    x:Name="TreeAllImageRolls"
                    Margin="3,3,0,0"
                    md:ScrollViewerAssist.IsAutoHideEnabled="True"
                    ItemContainerStyleSelector="{StaticResource ImageRollsTreeViewItemStyleSelector}"
                    ItemsSource="{Binding Source={StaticResource AllImageRolls}, Path=Groups}"
                    SelectedItemChanged="TreeAllImageRolls_SelectedItemChanged"
                    Style="{StaticResource MaterialDesignTreeView}">
                    <TreeView.Resources>

                        <HierarchicalDataTemplate DataType="{x:Type data:CollectionViewGroup}" ItemsSource="{Binding Items}">

                            <Grid>
                                <!--  First level (RollType) presentation  -->
                                <md:Card x:Name="FirstLevelPanel" Foreground="{DynamicResource MahApps.HamburgerMenu.Pane.Foreground}">
                                    <md:Card.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Offset="0" Color="{DynamicResource ImageRoll_Color_Active50}" />
                                            <GradientStop Offset="1" Color="{DynamicResource MahApps.Colors.HamburgerMenu}" />
                                        </LinearGradientBrush>
                                    </md:Card.Background>

                                    <DockPanel Height="32">

                                        <DockPanel
                                            Margin="3"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Center">

                                            <iconPacks:PackIconMaterial Margin="3" HorizontalAlignment="Left">
                                                <iconPacks:PackIconMaterial.Style>
                                                    <Style TargetType="{x:Type iconPacks:PackIconMaterial}">
                                                        <Setter Property="Kind" Value="Database" />
                                                        <Setter Property="ToolTip" Value="Images are stored in a database." />

                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Name}" Value="{x:Static imageRollEnums:ImageRollTypes.Directory}">
                                                                <Setter Property="Kind" Value="Folder" />
                                                                <Setter Property="ToolTip" Value="Images are loaded from a directory. Read Only!" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </iconPacks:PackIconMaterial.Style>
                                            </iconPacks:PackIconMaterial>

                                            <TextBlock
                                                Margin="3"
                                                FontWeight="Bold"
                                                Text="{Binding Name}" />

                                            <TextBlock Margin="6,3,0,3" Text="{Binding ItemCount, StringFormat='({0})'}" />
                                        </DockPanel>
                                    </DockPanel>
                                </md:Card>

                                <!--  Second level (StandardGroup) presentation  -->
                                <DockPanel
                                    x:Name="SecondLevelPanel"
                                    LastChildFill="False"
                                    Visibility="Collapsed">
                                    <Border
                                        Width="54"
                                        Height="54"
                                        Margin="0,0,6,0"
                                        Padding="0"
                                        Background="White"
                                        BorderBrush="{DynamicResource MahApps.Brushes.Accent}"
                                        BorderThickness="1"
                                        CornerRadius="4">
                                        <Grid>
                                            <!--  Main grading standard image  -->
                                            <Image
                                                Width="42"
                                                Height="42"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center">
                                                <Image.Style>
                                                    <Style TargetType="Image">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Items[0].SelectedGradingStandard}" Value="{x:Static barCommon:GradingStandards.ISO_IEC_15415}">
                                                                <Setter Property="Source" Value="/Assets/Images/barcode-2d.png" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Items[0].SelectedGradingStandard}" Value="{x:Static barCommon:GradingStandards.ISO_IEC_15416}">
                                                                <Setter Property="Source" Value="/Assets/Images/barcode-1d1.png" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Items[0].SelectedGradingStandard}" Value="{x:Static barCommon:GradingStandards.ISO_IEC_TR_29158}">
                                                                <Setter Property="Source" Value="/Assets/Images/dpm.png" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Items[0].SelectedGradingStandard}" Value="{x:Static barCommon:GradingStandards.None}">
                                                                <Setter Property="Source" Value="/Assets/Images/all-codes.png" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Image.Style>
                                            </Image>

                                            <!--  Application standard overlay (e.g., GS1)  -->
                                            <Image
                                                Width="32"
                                                Height="32"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Bottom">
                                                <Image.Style>
                                                    <Style TargetType="Image">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Items[0].SelectedApplicationStandard}" Value="{x:Static barCommon:ApplicationStandards.GS1}">
                                                                <Setter Property="Source" Value="/Assets/Images/GS1.png" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Image.Style>
                                            </Image>
                                        </Grid>
                                    </Border>

                                    <StackPanel VerticalAlignment="Center" Orientation="Vertical">
                                        <TextBlock FontWeight="SemiBold" Text="{Binding Name}" />
                                        <TextBlock
                                            Margin="0,2,0,0"
                                            Style="{StaticResource MahApps.Styles.TextBlock.AutoCollapsing}"
                                            Text="{Binding ItemCount, StringFormat='Rolls: {0}'}" />
                                    </StackPanel>
                                </DockPanel>
                            </Grid>

                            <!--
                                Triggers decide which panel is visible:
                                If Items[0] is an ImageRoll (has RollType), it's second level.
                            -->
                            <HierarchicalDataTemplate.Triggers>
                                <DataTrigger Binding="{Binding Items[0].RollType}" Value="{x:Static imageRollEnums:ImageRollTypes.Directory}">
                                    <Setter TargetName="FirstLevelPanel" Property="Visibility" Value="Collapsed" />
                                    <Setter TargetName="SecondLevelPanel" Property="Visibility" Value="Visible" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Items[0].RollType}" Value="{x:Static imageRollEnums:ImageRollTypes.Database}">
                                    <Setter TargetName="FirstLevelPanel" Property="Visibility" Value="Collapsed" />
                                    <Setter TargetName="SecondLevelPanel" Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </HierarchicalDataTemplate.Triggers>
                        </HierarchicalDataTemplate>
                    </TreeView.Resources>

                </TreeView>

            </md:DrawerHost>
        </DockPanel>
    </DockPanel>

</UserControl>