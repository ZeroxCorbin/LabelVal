<UserControl
    x:Class="LabelVal.Run.Views.RunDatabases"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:componentmodel="clr-namespace:System.ComponentModel;assembly=WindowsBase"
    xmlns:converters="clr-namespace:LabelVal.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:databases="clr-namespace:LabelVal.Run.Databases"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:imageRollConverters="clr-namespace:LabelVal.ImageRolls.Converters"
    xmlns:local="clr-namespace:LabelVal.Run.Views"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:sectors="clr-namespace:LabelVal.Sectors.Interfaces"
    xmlns:viewModels="clr-namespace:LabelVal.Run.ViewModels"
    d:DataContext="{d:DesignInstance Type=viewModels:RunDatabases}"
    mc:Ignorable="d">
    <UserControl.Resources>
        <converters:ContentGeneratorConverter x:Key="ContentGeneratorConverter" />
        <imageRollConverters:GS1TableNamesConverter x:Key="GS1TableNamesConverter" />

        <CollectionViewSource x:Key="cvsRunEntriesList" Source="{Binding RunEntriesList}">
            <CollectionViewSource.SortDescriptions>
                <componentmodel:SortDescription Direction="Ascending" PropertyName="GradingStandard" />
                <componentmodel:SortDescription Direction="Ascending" PropertyName="CameraMAC" />
                <componentmodel:SortDescription Direction="Ascending" PropertyName="ProductPart" />
                <componentmodel:SortDescription Direction="Descending" PropertyName="StartDateTime" />
                <!--<componentmodel:SortDescription PropertyName="Template.Top" Direction="Ascending"/>-->
            </CollectionViewSource.SortDescriptions>
            <CollectionViewSource.GroupDescriptions>
                <PropertyGroupDescription PropertyName="GradingStandard" />
                <PropertyGroupDescription PropertyName="CameraMAC" />
                <PropertyGroupDescription PropertyName="ProductPart" />
            </CollectionViewSource.GroupDescriptions>
        </CollectionViewSource>

        <CollectionViewSource x:Key="cvsRunEntriesList_NoGroup" Source="{Binding RunEntriesList}">
            <CollectionViewSource.SortDescriptions>
                <componentmodel:SortDescription Direction="Ascending" PropertyName="GradingStandard" />
                <componentmodel:SortDescription Direction="Ascending" PropertyName="CameraMAC" />
                <componentmodel:SortDescription Direction="Ascending" PropertyName="ProductPart" />
                <componentmodel:SortDescription Direction="Descending" PropertyName="StartDateTime" />
                <!--<componentmodel:SortDescription PropertyName="Template.Top" Direction="Ascending"/>-->
            </CollectionViewSource.SortDescriptions>
            <CollectionViewSource.GroupDescriptions>
                <PropertyGroupDescription PropertyName="CameraMAC" />
                <PropertyGroupDescription PropertyName="ProductPart" />
            </CollectionViewSource.GroupDescriptions>
        </CollectionViewSource>

        <DataTemplate x:Key="imageRollItemTemplate_ListView">
            <ListView
                MinWidth="200"
                BorderThickness="0"
                ItemsSource="{Binding Source={StaticResource ResourceKey=cvsRunEntriesList_NoGroup}}"
                SelectedItem="{Binding DataContext.SelectedRunEntry, RelativeSource={RelativeSource AncestorType=UserControl}}"
                Style="{StaticResource MaterialDesignListView}">
                <ListView.GroupStyle>
                    <GroupStyle>
                        <GroupStyle.ContainerStyle>
                            <Style TargetType="{x:Type GroupItem}">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="{x:Type GroupItem}">
                                            <Expander
                                                Margin="0,1"
                                                mah:HeaderedControlHelper.HeaderBackground="{DynamicResource MahApps.Brushes.Accent4}"
                                                md:ExpanderAssist.ExpanderButtonPosition="Start"
                                                BorderThickness="0"
                                                Style="{StaticResource MaterialDesignExpander}">
                                                <Expander.Header>
                                                    <TextBlock FontSize="{DynamicResource MahApps.Font.Size.ContextMenu}" Text="{Binding Name}" />
                                                </Expander.Header>

                                                <ItemsPresenter />

                                            </Expander>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </GroupStyle.ContainerStyle>
                    </GroupStyle>
                </ListView.GroupStyle>

                <ListView.ItemContainerStyle>
                    <Style BasedOn="{StaticResource MahApps.Styles.ListViewItem}" TargetType="ListViewItem" />
                </ListView.ItemContainerStyle>

                <ListView.ItemTemplate>
                    <DataTemplate DataType="{x:Type databases:RunEntry}">
                        <DockPanel Margin="5">
                            <Border
                                Margin="0,0,6,0"
                                Background="{DynamicResource MahApps.Brushes.Accent2}"
                                Style="{StaticResource groupLeft}" />
                            <Border
                                Margin="-6,3,0,0"
                                Background="{DynamicResource MahApps.Brushes.Accent2}"
                                Style="{StaticResource groupBottom}" />

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <TextBlock
                                    Grid.ColumnSpan="2"
                                    Margin="3"
                                    Text="{Binding StartDateTime}" />

                                <iconPacks:PackIconMaterial
                                    Grid.Row="1"
                                    Margin="0,3,6,0"
                                    VerticalAlignment="Center"
                                    Kind="Run">
                                    <iconPacks:PackIconMaterial.Style>
                                        <Style TargetType="{x:Type iconPacks:PackIconMaterial}">
                                            <Setter Property="Foreground" Value="{DynamicResource CB_Green}" />

                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsComplete}" Value="False">
                                                    <Setter Property="Background" Value="{DynamicResource SectorError_Brush}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </iconPacks:PackIconMaterial.Style>
                                </iconPacks:PackIconMaterial>

                                <DockPanel Grid.Row="2">
                                    <TextBlock Text="{Binding Loops}" />
                                    <TextBlock Text="/" />
                                    <TextBlock Text="{Binding CompletedLoops}" />
                                </DockPanel>

                                <md:Card
                                    Grid.Row="1"
                                    Grid.Column="1"
                                    Margin="3,0"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Top"
                                    Background="{DynamicResource MahApps.Brushes.ThemeBackground}"
                                    Foreground="{DynamicResource MahApps.Brushes.ThemeForeground}">

                                    <DockPanel>

                                        <TextBlock
                                            Margin="10,3"
                                            Text="{Binding ImageRollName}"
                                            TextWrapping="Wrap">
                                            <TextBlock.Style>
                                                <Style BasedOn="{StaticResource MahApps.Styles.TextBlock.HamburgerMenuHeader}" TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Visible" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding ImageRollName}" Value="">
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>

                                        <TextBlock Margin="10,3" Text="{Binding Gs1TableName, Converter={StaticResource GS1TableNamesConverter}, StringFormat={}Table {0}}">
                                            <TextBlock.Style>
                                                <Style BasedOn="{StaticResource MahApps.Styles.TextBlock.HamburgerMenuHeader}" TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding GradingStandard}" Value="{x:Static sectors:StandardsTypes.GS1}">
                                                            <Setter Property="Visibility" Value="Visible" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </DockPanel>

                                </md:Card>

                                <DockPanel
                                    Grid.Row="2"
                                    Grid.Column="1"
                                    HorizontalAlignment="Left">

                                    <TextBlock Margin="6,0" VerticalAlignment="Center">
                                        <TextBlock.Background>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                <GradientStop Offset="0" Color="{DynamicResource MahApps.Colors.Accent2}" />
                                                <GradientStop Offset="1" Color="{DynamicResource MahApps.Colors.Accent4}" />
                                            </LinearGradientBrush>
                                        </TextBlock.Background>

                                        <TextBlock.Style>
                                            <Style BasedOn="{StaticResource MahApps.Styles.TextBlock}" TargetType="TextBlock">
                                                <Setter Property="Text" Value="{Binding TargetDPI, StringFormat={}{0} DPI}" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding TargetDPI}" Value="0">
                                                        <Setter Property="Text" Value="Any DPI" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <!--<iconPacks:PackIconMaterial Margin="3" HorizontalAlignment="Left" VerticalAlignment="Center">
                                        <iconPacks:PackIconMaterial.Style>
                                            <Style TargetType="{x:Type iconPacks:PackIconMaterial}">
                                                <Setter Property="Kind" Value="FormatListNumbered"/>
                                                <Setter Property="ToolTip" Value="Images are stored."/>

                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding WriteSectorsBeforeProcess}" Value="True">
                                                        <Setter Property="Kind" Value="PlaylistEdit"/>
                                                        <Setter Property="ToolTip" Value="Images are rooted."/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </iconPacks:PackIconMaterial.Style>
                                    </iconPacks:PackIconMaterial>-->

                                </DockPanel>
                            </Grid>
                        </DockPanel>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </DataTemplate>

        <DataTemplate x:Key="runEntryContent">
            <ContentControl Content="{Binding Items}" ContentTemplate="{StaticResource imageRollItemTemplate_ListView}" />
        </DataTemplate>

        <DataTemplate x:Key="runEntryIT">
            <DockPanel Background="White">
                <Image Width="36" Height="36">
                    <Image.Style>
                        <Style TargetType="Image">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Name}" Value="{x:Static sectors:StandardsTypes.GS1}">
                                    <Setter Property="Source" Value="/Assets/Images/GS1.png" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Name}" Value="{x:Static sectors:StandardsTypes.ISO15415_15416}">
                                    <Setter Property="Source" Value="/Assets/Images/all-codes.png" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Name}" Value="{x:Static sectors:StandardsTypes.ISO15416}">
                                    <Setter Property="Source" Value="/Assets/Images/barcode-2d.png" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Name}" Value="{x:Static sectors:StandardsTypes.ISO15415}">
                                    <Setter Property="Source" Value="/Assets/Images/barcode-1d1.png" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Name}" Value="{x:Static sectors:StandardsTypes.OCR_OCV}">
                                    <Setter Property="Source" Value="/Assets/Images/OCR.png" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Name}" Value="{x:Static sectors:StandardsTypes.None}">
                                    <Setter Property="Source" Value="/Assets/Images/all-codes.png" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Image.Style>
                </Image>
            </DockPanel>
        </DataTemplate>

        <Style
            x:Key="runEntryICS"
            BasedOn="{StaticResource MahApps.Styles.TabItem}"
            TargetType="TabItem">

            <!--  This generates the content for the tab item  -->
            <Setter Property="Content" Value="{Binding Converter={StaticResource ContentGeneratorConverter}, ConverterParameter={StaticResource runEntryContent}}" />

            <Setter Property="Background" Value="{DynamicResource MahApps.HamburgerMenu.Pane.Background}" />
            <Setter Property="BorderThickness" Value="1,1,1,0" />
            <Setter Property="Margin" Value="0" />

            <Style.Triggers>
                <!--<DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=TabItem}}" Value="{x:Static sectors:StandardsTypes.GS1}">
                    <Setter Property="Background" Value="{DynamicResource MahApps.Colors.Accent3}"/>
                </DataTrigger>-->

                <DataTrigger Binding="{Binding Name}" Value="{x:Static sectors:StandardsTypes.GS1}">
                    <Setter Property="ToolTip" Value="GS1" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Name}" Value="{x:Static sectors:StandardsTypes.ISO15415_15416}">
                    <Setter Property="ToolTip" Value="ISO/IEC 15416-15415" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Name}" Value="{x:Static sectors:StandardsTypes.ISO15416}">
                    <Setter Property="ToolTip" Value="ISO/IEC 15416" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Name}" Value="{x:Static sectors:StandardsTypes.ISO15415}">
                    <Setter Property="ToolTip" Value="ISO/IEC 15415" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Name}" Value="{x:Static sectors:StandardsTypes.OCR_OCV}">
                    <Setter Property="ToolTip" Value="OCR/OCV" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Name}" Value="{x:Static sectors:StandardsTypes.None}">
                    <Setter Property="ToolTip" Value="None" />
                </DataTrigger>
            </Style.Triggers>

        </Style>

    </UserControl.Resources>

    <mah:MetroTabControl
        ItemContainerStyle="{StaticResource runEntryICS}"
        ItemTemplate="{StaticResource runEntryIT}"
        ItemsSource="{Binding Groups, Source={StaticResource ResourceKey=cvsRunEntriesList}}"
        Style="{StaticResource MahApps.Styles.TabControl}"
        TabStripPlacement="Left" />
</UserControl>
