<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks">

    <Style
        x:Key="FlatToolBarStyle"
        BasedOn="{StaticResource {x:Type ToolBar}}"
        TargetType="ToolBar">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ToolBar">
                    <Border Padding="{TemplateBinding Padding}" Background="{TemplateBinding Background}">
                        <ItemsPresenter />
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!--  Shared toolbar for L95 Verifier  -->
    <DataTemplate x:Key="V5ScannerToolbarTemplate">
        <ToolBarTray
            Margin="3"
            VerticalAlignment="Top"
            DataContext="{Binding}"
            IsLocked="True"
            Orientation="Vertical">
            <ToolBar
                Padding="0,0,0,3"
                VerticalAlignment="Top"
                VerticalContentAlignment="Top"
                Background="{DynamicResource MahApps.HamburgerMenu.Pane.Background}"
                Style="{StaticResource FlatToolBarStyle}">

                <!--  Centralized spacing + sizing  -->
                <ToolBar.Resources>
                    <!--  Adjust this Thickness once to affect all buttons  -->
                    <Thickness x:Key="L95ToolBarButtonSpacing">3,3,3,0</Thickness>

                    <!--  Implicit style for all buttons in this toolbar  -->
                    <Style
                        x:Key="ToolBarButtons"
                        BasedOn="{StaticResource MahApps.Styles.Button}"
                        TargetType="Button">
                        <Setter Property="Margin" Value="{StaticResource L95ToolBarButtonSpacing}" />
                        <Setter Property="BorderThickness" Value="0" />
                    </Style>
                </ToolBar.Resources>

                <!--  Connect / Disconnect  -->
                <Button Command="{Binding ConnectCommand}">
                    <Button.Style>
                        <Style BasedOn="{StaticResource ToolBarButtons}" TargetType="Button">
                            <Setter Property="Content">
                                <Setter.Value>
                                    <iconPacks:Modern Kind="Connect" />
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Controller.IsConnected}" Value="True">
                                    <Setter Property="Content">
                                        <Setter.Value>
                                            <iconPacks:Modern Kind="Disconnect" />
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!--  Settings (hidden when docked OR hosted in menu mini bar)  -->
                <Button Command="{Binding ShowSettingsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" ToolTip="Show Settings">
                    <Button.Style>
                        <Style BasedOn="{StaticResource ToolBarButtons}" TargetType="Button">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsDocked, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                                <!--  New: hide when hosted inside the menu ContentControl (Tag=MenuHost)  -->
                                <DataTrigger Binding="{Binding Tag, RelativeSource={RelativeSource AncestorType=ContentControl}}" Value="MenuHost">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <iconPacks:PackIconMaterial Kind="Cog" />
                </Button>

                <!--  Open Browser  -->
                <Button
                    Command="{Binding OpenInBrowserCommand}"
                    Style="{StaticResource ToolBarButtons}"
                    ToolTip="Open V5 WebLink. Shift + Click to open admin UI!">
                    <iconPacks:PackIconModern Kind="Browser" />
                </Button>

            </ToolBar>
        </ToolBarTray>

    </DataTemplate>
</ResourceDictionary>