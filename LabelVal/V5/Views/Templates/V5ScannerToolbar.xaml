<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks">

    <!--  Local flat toolbar style (moved from Scanner.xaml)  -->
    <Style
        x:Key="FlatToolBarStyle"
        BasedOn="{StaticResource {x:Type ToolBar}}"
        TargetType="ToolBar">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ToolBar">
                    <Border Padding="{TemplateBinding Padding}" Background="{TemplateBinding Background}">
                        <ItemsPresenter />
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!--  Shared Scanner toolbar template  -->
    <DataTemplate x:Key="V5ScannerToolbarTemplate">
        <!--  DataContext expected: Scanner ViewModel (SelectedDevice in menu, or current DataContext in Scanner view)  -->

        <ToolBarTray
            Margin="3"
            VerticalAlignment="Top"
            DataContext="{Binding}"
            IsLocked="True"
            Orientation="Vertical">
            <ToolBar
                Padding="0"
                VerticalAlignment="Top"
                VerticalContentAlignment="Top"
                Background="{DynamicResource MahApps.HamburgerMenu.Pane.Background}"
                Style="{StaticResource FlatToolBarStyle}">

                <!--  Connect / Disconnect  -->
                <Button
                    Margin="3,3,3,0"
                    BorderThickness="0"
                    Command="{Binding ConnectCommand}">
                    <Button.Style>
                        <Style BasedOn="{StaticResource MahApps.Styles.Button}" TargetType="Button">
                            <Setter Property="Content">
                                <Setter.Value>
                                    <iconPacks:Modern Kind="Connect" />
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Controller.IsConnected}" Value="True">
                                    <Setter Property="Content">
                                        <Setter.Value>
                                            <iconPacks:Modern Kind="Disconnect" />
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!--  Settings (hidden when docked OR hosted in menu mini bar)  -->
                <Button
                    Margin="3,3,3,0"
                    BorderThickness="0"
                    Command="{Binding ShowSettingsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    ToolTip="Show Settings">
                    <Button.Style>
                        <Style BasedOn="{StaticResource MahApps.Styles.Button}" TargetType="Button">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsDocked, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                                <!--  New: hide when hosted inside the menu ContentControl (Tag=MenuHost)  -->
                                <DataTrigger Binding="{Binding Tag, RelativeSource={RelativeSource AncestorType=ContentControl}}" Value="MenuHost">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <iconPacks:PackIconMaterial Kind="Cog" />
                </Button>

                <!--  Open Browser  -->
                <Button
                    Margin="3"
                    BorderThickness="0"
                    Command="{Binding OpenInBrowserCommand}"
                    Style="{StaticResource MahApps.Styles.Button}"
                    ToolTip="Open V5 WebLink. Shift + Click to open admin UI!">
                    <iconPacks:PackIconModern Kind="Browser" />
                </Button>

            </ToolBar>
        </ToolBarTray>

    </DataTemplate>
</ResourceDictionary>