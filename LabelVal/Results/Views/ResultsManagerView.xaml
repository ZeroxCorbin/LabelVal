<!--
    This UserControl provides a comprehensive interface for managing and viewing image results.
    It includes a toolbar for actions related to image rolls, device interactions, and result manipulation.
    The main view consists of a scrollable list of image results with a thumbnail navigator and a side panel for viewing JSON data.
-->
<UserControl
    x:Class="LabelVal.Results.Views.ResultsManagerView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:barCommon="clr-namespace:BarcodeVerification.lib.Common;assembly=BarcodeVerification.lib"
    xmlns:componentmodel="clr-namespace:System.ComponentModel;assembly=WindowsBase"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dialog="clr-namespace:MahApps.Metro.Controls.Dialogs;assembly=MahApps.Metro"
    xmlns:helpers="clr-namespace:LabelVal.Results.Helpers"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:imageRollEnums="clr-namespace:LabelVal.ImageRolls.ViewModels"
    xmlns:imageroll="clr-namespace:LabelVal.ImageRolls.ViewModels"
    xmlns:json="clr-namespace:JSONViewer_WPF;assembly=JSONViewer_WPF"
    xmlns:local="clr-namespace:LabelVal.Results.Views"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:sectors="clr-namespace:LabelVal.Sectors.Classes"
    xmlns:system="clr-namespace:System;assembly=mscorlib"
    xmlns:vm="clr-namespace:LabelVal.Results.ViewModels"
    d:DataContext="{d:DesignInstance Type=vm:ResultsManagerViewModel}"
    dialog:DialogParticipation.Register="{Binding}"
    Unloaded="UserControl_Unloaded"
    mc:Ignorable="d">

    <!--  Resources section defining shared elements and styles for this control.  -->
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Templates/V5TriggerButton.xaml" />
                <ResourceDictionary Source="Templates/V275TriggerButton.xaml" />
                <ResourceDictionary Source="Templates/L95Buttons.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!--  CollectionViewSource for sorting the image results entries by their source image order.  -->
            <CollectionViewSource
                x:Key="CvsResultssEntries"
                IsLiveSortingRequested="True"
                Source="{Binding ResultssEntries}">
                <CollectionViewSource.SortDescriptions>
                    <componentmodel:SortDescription Direction="Ascending" PropertyName="SourceImage.Order" />
                </CollectionViewSource.SortDescriptions>
            </CollectionViewSource>
        </ResourceDictionary>
    </UserControl.Resources>

    <!--  Main layout container for the Image Results Manager.  -->
    <DockPanel VerticalAlignment="Top">

        <!--  Top toolbar area containing image roll information and controls.  -->
        <DockPanel Margin="3,3,0,0" DockPanel.Dock="Top">

            <md:Card
                Margin="3,3,0,0"
                HorizontalAlignment="Left"
                Background="{DynamicResource MahApps.HamburgerMenu.Pane.Background}"
                Foreground="{DynamicResource MahApps.HamburgerMenu.Pane.Foreground}">

                <DockPanel>

                    <!--  Left-side quick action panel for image roll settings.  -->
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <DockPanel Grid.Row="0" Background="Teal">
                            <iconPacks:PackIconMaterial
                                Width="48"
                                Height="40"
                                Margin="1,0"
                                Padding="6"
                                HorizontalAlignment="Center"
                                Kind="FilmstripBoxMultiple" />
                        </DockPanel>

                        <!--  ListBox to select where new images are added (Top or Bottom).  -->
                        <ListBox
                            Grid.Row="1"
                            md:ListBoxAssist.CanUserToggleSelectedItem="True"
                            BorderThickness="0"
                            Focusable="False"
                            SelectedValue="{Binding ActiveImageRoll.ImageAddPosition}"
                            ToolTip="Select where to add new images.">
                            <ListBox.ItemContainerStyle>
                                <Style BasedOn="{StaticResource MaterialDesignToolToggleListBoxItem}" TargetType="ListBoxItem">
                                    <Setter Property="Padding" Value="4" />
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <x:Static Member="imageroll:ImageAddPositions.Top" />
                            <x:Static Member="imageroll:ImageAddPositions.Bottom" />

                            <ListBox.Style>
                                <Style BasedOn="{StaticResource MahApps.Styles.ListBox}" TargetType="{x:Type ListBox}">
                                    <Setter Property="Visibility" Value="Visible" />
                                    <Style.Triggers>
                                        <!--  Collapsed if the image roll is locked.  -->
                                        <DataTrigger Binding="{Binding ActiveImageRoll.IsLocked}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>

                            </ListBox.Style>
                        </ListBox>
                    </Grid>

                    <DockPanel>

                        <!--  Header section displaying details of the currently selected image roll.  -->
                        <DockPanel DockPanel.Dock="Top">
                            <DockPanel.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Offset="0" Color="{DynamicResource MahApps.Colors.Accent3}" />
                                    <GradientStop Offset="1" Color="{DynamicResource MahApps.Colors.HamburgerMenu}" />
                                </LinearGradientBrush>
                            </DockPanel.Background>

                            <DockPanel Margin="6,0,6,3">


                                <!--  Name  -->
                                <StackPanel>
                                    <TextBlock Style="{StaticResource MahApps.Styles.TextBlock.AutoCollapsing}" Text="Name" />
                                    <TextBlock Margin="3,0" Text="{Binding ActiveImageRoll.Name}">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ActiveImageRoll.Name}" Value="">
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>

                                <!--  Standard  -->
                                <StackPanel Margin="6,0,0,0">
                                    <TextBlock Style="{StaticResource MahApps.Styles.TextBlock.AutoCollapsing}" Text="App Standard" />
                                    <TextBlock Margin="3,0" Text="{Binding ActiveImageRoll.SelectedApplicationStandard, Converter={StaticResource EnumValueToDescription}}" />
                                </StackPanel>

                                <!--  GS1 Table  -->
                                <TextBlock VerticalAlignment="Bottom" Text="{Binding ActiveImageRoll.SelectedGS1Table, Converter={StaticResource EnumValueToDescription}, StringFormat={}: Table {0}}">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActiveImageRoll.SelectedApplicationStandard}" Value="{x:Static barCommon:ApplicationStandards.GS1}">
                                                    <Setter Property="Visibility" Value="Visible" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>

                                <!--  Standard  -->
                                <StackPanel Margin="6,0,0,0">
                                    <TextBlock Style="{StaticResource MahApps.Styles.TextBlock.AutoCollapsing}" Text="Grading Standard" />
                                    <TextBlock Margin="3,0" Text="{Binding ActiveImageRoll.SelectedGradingStandard}" />
                                </StackPanel>

                                <Border Margin="3,0,0,0" Style="{StaticResource imageBar}" />

                                <!--  Iamge Type  -->
                                <StackPanel Margin="6,0,0,0">
                                    <TextBlock Style="{StaticResource MahApps.Styles.TextBlock.AutoCollapsing}" Text="Use Image" />

                                    <DockPanel>

                                        <TextBlock Margin="6,0" Text="{Binding ActiveImageRoll.ImageType, Converter={StaticResource EnumValueToDescription}}" />

                                        <iconPacks:PackIconMaterial HorizontalAlignment="Left" VerticalAlignment="Center">
                                            <iconPacks:PackIconMaterial.Style>
                                                <Style TargetType="{x:Type iconPacks:PackIconMaterial}">
                                                    <Setter Property="Kind" Value="FilmstripBox" />
                                                    <Setter Property="ToolTip" Value="The source image will be used." />

                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding ActiveImageRoll.ImageType}" Value="{x:Static imageRollEnums:ImageRollImageTypes.Stored}">
                                                            <Setter Property="Kind" Value="StoreOutline" />
                                                            <Setter Property="ToolTip" Value="The stored image will be used." />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </iconPacks:PackIconMaterial.Style>
                                        </iconPacks:PackIconMaterial>
                                    </DockPanel>
                                </StackPanel>

                                <Border Margin="3,0,0,0" Style="{StaticResource imageBar}" />

                                <!--  Sector Type  -->
                                <StackPanel Margin="6,0,0,0">

                                    <TextBlock Style="{StaticResource MahApps.Styles.TextBlock.AutoCollapsing}" Text="Sector Type" />

                                    <DockPanel>

                                        <TextBlock Margin="6,0" Text="{Binding ActiveImageRoll.SectorType, Converter={StaticResource EnumValueToDescription}}" />

                                        <iconPacks:PackIconMaterial HorizontalAlignment="Left" VerticalAlignment="Center">
                                            <iconPacks:PackIconMaterial.Style>
                                                <Style TargetType="{x:Type iconPacks:PackIconMaterial}">

                                                    <Setter Property="Kind" Value="Minus" />

                                                    <Setter Property="ToolTip" Value="The template sectors are shared." />

                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding ActiveImageRoll.SectorType}" Value="{x:Static imageRollEnums:ImageRollSectorTypes.Dynamic}">

                                                            <Setter Property="Kind" Value="DataMatrixScan" />

                                                            <Setter Property="ToolTip" Value="The template sectors are independant." />

                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </iconPacks:PackIconMaterial.Style>
                                        </iconPacks:PackIconMaterial>
                                    </DockPanel>

                                </StackPanel>


                                <Border Margin="3,0,0,0" Style="{StaticResource imageBar}" />

                                <!--  Roll Type (Database or Directory)  -->
                                <StackPanel Margin="6,0,0,0">
                                    <TextBlock Style="{StaticResource MahApps.Styles.TextBlock.AutoCollapsing}" Text="Roll Location" />

                                    <DockPanel>
                                        <TextBlock Margin="6,0" Text="{Binding ActiveImageRoll.RollType, Converter={StaticResource EnumValueToDescription}}" />

                                        <iconPacks:PackIconMaterial HorizontalAlignment="Left" VerticalAlignment="Center">
                                            <iconPacks:PackIconMaterial.Style>
                                                <Style TargetType="{x:Type iconPacks:PackIconMaterial}">
                                                    <Setter Property="Kind" Value="Database" />
                                                    <Setter Property="ToolTip" Value="Images are stored in a database." />

                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding ActiveImageRoll.RollType}" Value="Directory">
                                                            <Setter Property="Kind" Value="Folder" />
                                                            <Setter Property="ToolTip" Value="Images are loaded from a directory. Read Only!" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </iconPacks:PackIconMaterial.Style>
                                        </iconPacks:PackIconMaterial>
                                    </DockPanel>
                                </StackPanel>

                                <Border Margin="3,0,0,0" Style="{StaticResource imageBar}" />

                                <!--  Target DPI  -->
                                <StackPanel Margin="6,0,0,0">
                                    <TextBlock Style="{StaticResource MahApps.Styles.TextBlock.AutoCollapsing}" Text="Target DPI" />

                                    <TextBlock Margin="6,0" VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style BasedOn="{StaticResource MahApps.Styles.TextBlock}" TargetType="TextBlock">
                                                <Setter Property="Text" Value="{Binding ActiveImageRoll.TargetDPI, StringFormat={}{0} DPI}" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ActiveImageRoll.TargetDPI}" Value="0">
                                                        <Setter Property="Text" Value="Any DPI" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>

                                <Border Margin="3,0,0,0" Style="{StaticResource imageBar}" />

                                <!--  Locked Status  -->
                                <StackPanel Margin="6,0,0,0">
                                    <TextBlock Style="{StaticResource MahApps.Styles.TextBlock.AutoCollapsing}" Text="Locked" />

                                    <DockPanel>
                                        <TextBlock Margin="6,0" Text="{Binding ActiveImageRoll.IsLocked, Converter={StaticResource EnumValueToDescription}}" />

                                        <iconPacks:PackIconMaterial HorizontalAlignment="Left" VerticalAlignment="Center">
                                            <iconPacks:PackIconMaterial.Style>
                                                <Style TargetType="{x:Type iconPacks:PackIconMaterial}">
                                                    <Setter Property="Kind" Value="LockOpenVariant" />
                                                    <Setter Property="ToolTip" Value="Image Roll is unlocked." />

                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding ActiveImageRoll.IsLocked}" Value="True">
                                                            <Setter Property="Kind" Value="Lock" />
                                                            <Setter Property="ToolTip" Value="Image Roll is locked." />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </iconPacks:PackIconMaterial.Style>
                                        </iconPacks:PackIconMaterial>
                                    </DockPanel>

                                </StackPanel>

                            </DockPanel>

                            <Border Style="{StaticResource imageBarHor}" />

                        </DockPanel>

                        <!--  Toolbar for controlling the image roll and results.  -->
                        <ToolBarTray>
                            <ToolBar
                                Margin="0"
                                BorderThickness="0"
                                ToolBarTray.IsLocked="True">

                                <DockPanel HorizontalAlignment="Left">

                                    <!--  Button to add new images to the roll. Visible only when the roll is not locked.  -->
                                    <Button Command="{Binding AddImageCommand}" ToolTip="Add new image(s) to the roll.">
                                        <Button.Style>
                                            <Style BasedOn="{StaticResource ToolBarButton}" TargetType="{x:Type Button}">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ActiveImageRoll.IsLocked}" Value="False">
                                                        <Setter Property="Visibility" Value="Visible" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>

                                        <DockPanel>
                                            <TextBlock
                                                HorizontalAlignment="Center"
                                                DockPanel.Dock="Top"
                                                Text="Add Image"
                                                Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                            <iconPacks:PackIconMaterial
                                                Width="24"
                                                Height="24"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Kind="ImagePlus" />

                                        </DockPanel>

                                    </Button>

                                    <!--  Device-specific buttons are loaded here from resources.  -->
                                    <ContentControl Content="{StaticResource V275TriggerButton}" />
                                    <ContentControl Content="{StaticResource V5TriggerButton}" />
                                    <StackPanel Orientation="Horizontal">
                                        <ContentControl Content="{StaticResource L95TriggerButton}" />
                                        <ContentControl Content="{StaticResource L95RedirectButton}" />
                                    </StackPanel>

                                </DockPanel>

                                <Separator Margin="6,0,3,0" Visibility="{Binding ActiveImageRoll.IsLocked, Converter={StaticResource BoolToVisibility}, ConverterParameter=Invert}"/>

                                <!--  Image Size Slider  -->
                                <DockPanel Margin="3,1,3,0" VerticalAlignment="Stretch">

                                    <TextBlock
                                        Margin="0,0,0,2"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Top"
                                        DockPanel.Dock="Top">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ImagesMaxHeight}" Value="400">
                                                        <Setter Property="Text" Value="Ex. Large" />
                                                    </DataTrigger>

                                                    <DataTrigger Binding="{Binding ImagesMaxHeight}" Value="300">
                                                        <Setter Property="Text" Value="Large" />
                                                    </DataTrigger>

                                                    <DataTrigger Binding="{Binding ImagesMaxHeight}" Value="200">
                                                        <Setter Property="Text" Value="Regular" />
                                                    </DataTrigger>

                                                    <DataTrigger Binding="{Binding ImagesMaxHeight}" Value="100">
                                                        <Setter Property="Text" Value="Small" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <Slider
                                        Width="48"
                                        Height="24"
                                        mah:SliderHelper.ChangeValueBy="LargeChange"
                                        IsSnapToTickEnabled="True"
                                        Maximum="400"
                                        Minimum="100"
                                        Style="{StaticResource MahApps.Styles.Slider.Flat}"
                                        TickFrequency="100"
                                        TickPlacement="BottomRight"
                                        ToolTip="Adjust the size of the images in the list."
                                        Value="{Binding ImagesMaxHeight}" />

                                </DockPanel>

                                <!--  Toggle button to show or hide alarms for errors and warnings.  -->
                                <StackPanel Margin="3,0" VerticalAlignment="Center">
                                    <TextBlock
                                        Margin="0,0,0,2"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Top"
                                        FontSize="10"
                                        FontWeight="DemiBold"
                                        Text="Alarms"
                                        Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                    <ToggleButton IsChecked="{Binding HideErrorsWarnings}">
                                        <ToggleButton.Style>
                                            <Style BasedOn="{StaticResource ToolBarActionToggleButton}" TargetType="ToggleButton">
                                                <Setter Property="ToolTip" Value="Show alarms for errors and warnings." />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HideErrorsWarnings}" Value="True">
                                                        <Setter Property="ToolTip" Value="Hide alarms for errors and warnings." />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ToggleButton.Style>

                                        <md:ToggleButtonAssist.OnContent>

                                            <iconPacks:PackIconFontAwesome
                                                Width="22"
                                                Height="22"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Kind="BellSlashSolid" />

                                        </md:ToggleButtonAssist.OnContent>

                                        <iconPacks:PackIconFontAwesome
                                            Width="22"
                                            Height="22"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Kind="BellSolid" />

                                    </ToggleButton>
                                </StackPanel>

                                <!--  Toggle button to switch between automatic and fixed dual-column layout for sectors.  -->
                                <StackPanel Margin="3,0" VerticalAlignment="Center">
                                    <TextBlock
                                        Margin="0,0,0,2"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Top"
                                        FontSize="10"
                                        FontWeight="DemiBold"
                                        Text="Columns"
                                        Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                    <ToggleButton IsChecked="{Binding DualSectorColumns}">
                                        <ToggleButton.Style>
                                            <Style BasedOn="{StaticResource ToolBarActionToggleButton}" TargetType="ToggleButton">
                                                <Setter Property="ToolTip" Value="Automatically adjust sector columns based on image size." />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DualSectorColumns}" Value="True">
                                                        <Setter Property="ToolTip" Value="Use a fixed dual-column layout for sectors." />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ToggleButton.Style>

                                        <md:ToggleButtonAssist.OnContent>
                                            <Grid>
                                                <iconPacks:PackIconModern
                                                    Width="22"
                                                    Height="22"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Kind="ColumnTwo" />
                                            </Grid>
                                        </md:ToggleButtonAssist.OnContent>

                                        <Grid>
                                            <iconPacks:PackIconModern
                                                Width="22"
                                                Height="22"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Kind="ColumnTwo" />
                                            <iconPacks:PackIconMaterial
                                                Width="18"
                                                Height="18"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Foreground="{DynamicResource MahApps.HamburgerMenu.Pane.Background}"
                                                Kind="AlphaA" />
                                        </Grid>
                                    </ToggleButton>
                                </StackPanel>

                                <!--  Toggle button to show or hide extended data for 2D grid sectors.  -->
                                <StackPanel Margin="3,0" VerticalAlignment="Center">
                                    <TextBlock
                                        Margin="0,0,0,2"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Top"
                                        FontSize="10"
                                        FontWeight="DemiBold"
                                        Text="2D Grids"
                                        Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                    <ToggleButton IsChecked="{Binding ShowExtendedData}">
                                        <ToggleButton.Style>
                                            <Style BasedOn="{StaticResource ToolBarActionToggleButton}" TargetType="ToggleButton">
                                                <Setter Property="ToolTip" Value="Show extended data for 2D grid sectors." />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ShowExtendedData}" Value="True">
                                                        <Setter Property="ToolTip" Value="Hide extended data for 2D grid sectors." />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ToggleButton.Style>

                                        <md:ToggleButtonAssist.OnContent>
                                            <Grid>
                                                <iconPacks:PackIconModern
                                                    Width="22"
                                                    Height="22"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Kind="Grid" />
                                                <iconPacks:PackIconJamIcons
                                                    Width="22"
                                                    Height="22"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Kind="QrCode" />
                                            </Grid>
                                        </md:ToggleButtonAssist.OnContent>
                                        <Grid>
                                            <iconPacks:PackIconJamIcons
                                                Width="22"
                                                Height="22"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Kind="QrCode" />
                                        </Grid>
                                    </ToggleButton>
                                </StackPanel>

                                <Separator  Margin="6,0,3,0" />

                                <!--  Button to copy all sector details to the clipboard as CSV.  -->
                                <Button
                                    Command="{Binding CopyAllSectorsToClipboardCommand}"
                                    CommandParameter="source"
                                    Style="{StaticResource ToolBarButton}"
                                    ToolTip="Copy all current sector details to the clipboard as CSV.">

                                    <DockPanel>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            DockPanel.Dock="Top"
                                            Text="Stored"
                                            Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                        <iconPacks:PackIconModern
                                            Width="24"
                                            Height="24"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Kind="PageCopy" />
                                    </DockPanel>
                                </Button>

                                <!--  Button to copy all sector details to the clipboard as CSV.  -->
                                <Button
                                    Command="{Binding CopyAllSectorsToClipboardCommand}"
                                    CommandParameter="current"
                                    Style="{StaticResource ToolBarButton}"
                                    ToolTip="Copy all current sector details to the clipboard as CSV.">


                                    <DockPanel>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            DockPanel.Dock="Top"
                                            Text="Current"
                                            Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                        <iconPacks:PackIconModern
                                            Width="24"
                                            Height="24"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Kind="PageCopy" />
                                    </DockPanel>
                                </Button>

                                <!--  Button to copy all sector details to the clipboard as CSV.  -->
                                <Button
                                    Command="{Binding CopyAllSectorsToClipboardCommand}"
                                    CommandParameter="all"
                                    Style="{StaticResource ToolBarButton}"
                                    ToolTip="Copy all stored and current sector details to the clipboard as CSV.">

                                    <DockPanel>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            DockPanel.Dock="Top"
                                            Text="All"
                                            Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                        <iconPacks:PackIconModern
                                            Width="24"
                                            Height="24"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Kind="PageCopy" />
                                    </DockPanel>
                                </Button>

                                <Separator  Margin="6,0,3,0" />

                                <!--  Button to store all current results to the database.  -->
                                <Button Command="{Binding StoreAllCurrentResultsCommand}" ToolTip="Store all current results (images and sectors) to the database.">

                                    <Button.Style>
                                        <Style BasedOn="{StaticResource ToolBarButton}" TargetType="{x:Type Button}">
                                            <Setter Property="Visibility" Value="Visible" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding SelectedResultsDatabase.IsLocked}" Value="True">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>

                                    <DockPanel>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            DockPanel.Dock="Top"
                                            Text="Store All"
                                            Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                        <iconPacks:PackIconMaterial
                                            Width="24"
                                            Height="24"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Kind="StorePlusOutline" />
                                    </DockPanel>
                                </Button>

                                <!--  Button to clear all current results from the view.  -->
                                <Button
                                    Command="{Binding ClearAllCurrentResultsCommand}"
                                    Style="{StaticResource ToolBarButton}"
                                    ToolTip="Clear all current results (images and sectors).">

                                    <DockPanel>
                                        <TextBlock
                                            HorizontalAlignment="Center"
                                            DockPanel.Dock="Top"
                                            Text="Clear All"
                                            Visibility="{Binding AppSettings.ShowButtonText, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                        <iconPacks:PackIconMaterialDesign
                                            Width="24"
                                            Height="24"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Kind="ClearAll" />
                                    </DockPanel>
                                </Button>
                            </ToolBar>
                        </ToolBarTray>
                    </DockPanel>

                </DockPanel>
            </md:Card>

        </DockPanel>

        <!--  Main content area, including the results list and the JSON viewer drawer.  -->
        <DockPanel VerticalAlignment="Top" DockPanel.Dock="Top">
            <Border Style="{StaticResource groupLeft}" />
            <Border Style="{StaticResource groupBottom}" />

            <!--  Main content area.  -->
            <DockPanel>

                <!--  Left-side panel for thumbnail navigation.  -->
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <md:Card
                        Height="24"
                        Margin="3,3,0,0"
                        HorizontalAlignment="Stretch"
                        Background="{DynamicResource MahApps.HamburgerMenu.Pane.Background}"
                        DockPanel.Dock="Top"
                        Foreground="{DynamicResource MahApps.HamburgerMenu.Pane.Foreground}">

                        <TextBlock
                            Margin="6,0,6,3"
                            DockPanel.Dock="Top"
                            Style="{StaticResource MahApps.Styles.TextBlock.HamburgerMenuHeader}"
                            Text="Navigate" />


                    </md:Card>

                    <!--  ListBox displaying thumbnails of the image results for quick navigation.  -->
                    <ListBox
                        x:Name="ImageRollThumbnails"
                        Grid.Row="1"
                        MaxWidth="120"
                        DockPanel.Dock="Left"
                        ItemsSource="{Binding Source={StaticResource CvsResultssEntries}}"
                        ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                        ScrollViewer.VerticalScrollBarVisibility="Auto"
                        SelectedItem="{Binding TopmostItem, Mode=OneWay}"
                        ToolTip="Click to navigate to an image.">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="1" />
                                <Setter Property="Margin" Value="0" />
                            </Style>
                        </ListBox.ItemContainerStyle>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Button
                                    Width="40"
                                    Height="auto"
                                    Padding="0"
                                    Command="{Binding BringIntoViewHandlerCommand}"
                                    Style="{StaticResource MahApps.Styles.Button.Chromeless}">
                                    <Border x:Name="HighlightBorder" BorderThickness="2">
                                        <StackPanel>
                                            <Image Height="30" Source="{Binding SourceImage.ImageLow}" />
                                            <TextBlock
                                                HorizontalAlignment="Center"
                                                FontSize="8"
                                                Text="{Binding SourceImage.Order}" />
                                        </StackPanel>
                                    </Border>
                                </Button>
                                <DataTemplate.Triggers>
                                    <!--  Highlights the thumbnail that is currently at the top of the viewport.  -->
                                    <DataTrigger Binding="{Binding IsTopmost}" Value="True">
                                        <Setter TargetName="HighlightBorder" Property="BorderBrush" Value="{DynamicResource MahApps.Brushes.Accent}" />
                                    </DataTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>


                <!--  ScrollViewer for the main list of image results.  -->
                <ScrollViewer
                    x:Name="ResultssScrollViewer"
                    Margin="0"
                    HorizontalScrollBarVisibility="Disabled"
                    PreviewKeyDown="ResultssScrollViewer_PreviewKeyDown"
                    PreviewMouseWheel="ResultssScrollViewer_PreviewMouseWheel"
                    ScrollChanged="ResultssScrollViewer_ScrollChanged"
                    Style="{StaticResource MahApps.Styles.ScrollViewer}"
                    VerticalScrollBarVisibility="Auto">

                    <!--  ItemsControl to display the collection of image result entries.  -->
                    <ItemsControl x:Name="ResultssItemsControl" ItemsSource="{Binding Source={StaticResource CvsResultssEntries}}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <!--  Each item is rendered using the ResultsEntry UserControl.  -->
                                <local:ResultsEntry />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </DockPanel>
        </DockPanel>
    </DockPanel>
</UserControl>