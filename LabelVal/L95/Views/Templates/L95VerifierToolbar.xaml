<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:watchers="clr-namespace:Watchers.lib.Process;assembly=Watchers.lib">

    <!--  Local (moved) flat toolbar style  -->
    <Style
        x:Key="FlatToolBarStyle"
        BasedOn="{StaticResource {x:Type ToolBar}}"
        TargetType="ToolBar">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ToolBar">
                    <Border Padding="{TemplateBinding Padding}" Background="{TemplateBinding Background}">
                        <ItemsPresenter />
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!--  Shared toolbar for L95 Verifier  -->
    <DataTemplate x:Key="L95VerifierToolbarTemplate">
        <ToolBarTray
            Margin="3"
            
            VerticalAlignment="Top"
            DataContext="{Binding}"
            IsLocked="True"
            Orientation="Vertical">
            <ToolBar
                
                Padding="0,0,0,3"
                VerticalAlignment="Top"
                VerticalContentAlignment="Top"
                Background="{DynamicResource MahApps.HamburgerMenu.Pane.Background}"
                Style="{StaticResource FlatToolBarStyle}">

                <!--  Centralized spacing + sizing  -->
                <ToolBar.Resources>
                    <!--  Adjust this Thickness once to affect all buttons  -->
                    <Thickness x:Key="L95ToolBarButtonSpacing">3,3,3,0</Thickness>

                    <!--  Implicit style for all buttons in this toolbar  -->
                    <Style x:Key="ToolBarButton" BasedOn="{StaticResource MahApps.Styles.Button}" TargetType="Button">
                        <Setter Property="Margin" Value="{StaticResource L95ToolBarButtonSpacing}" />
                        <Setter Property="BorderThickness" Value="0" />
                    </Style>
                </ToolBar.Resources>

                <!--  Connect / Disconnect  -->
                <Button Command="{Binding ConnectCommand}">
                    <Button.Style>
                        <Style BasedOn="{StaticResource ToolBarButton}" TargetType="Button">
                            <Setter Property="Content">
                                <Setter.Value>
                                    <iconPacks:Modern Kind="Connect" />
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Controller.IsConnected}" Value="True">
                                    <Setter Property="Content">
                                        <Setter.Value>
                                            <iconPacks:Modern Kind="Disconnect" />
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>
                                <!--  If you still need to collapse spacing in Exited state, you can override Margin  -->
                                <DataTrigger Binding="{Binding Controller.ProcessState}" Value="{x:Static watchers:Win32_ProcessWatcherProcessState.Exited}">
                                    <Setter Property="Margin" Value="3" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!--  LVS Super User  -->
                <Button Command="{Binding EnterLvsCredentialsCommand}" ToolTip="Login as LVS super user">
                    <Button.Style>
                        <Style BasedOn="{StaticResource ToolBarButton}" TargetType="Button">
                            <Setter Property="Visibility" Value="Visible" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Controller.ProcessState}" Value="{x:Static watchers:Win32_ProcessWatcherProcessState.Exited}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <iconPacks:PackIconMaterial Kind="AccountStar" />
                </Button>

                <!--  Admin  -->
                <Button Command="{Binding EnterAdminCredentialsCommand}" ToolTip="Login as Admin">
                    <Button.Style>
                        <Style BasedOn="{StaticResource ToolBarButton}" TargetType="Button">
                            <Setter Property="Visibility" Value="Visible" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Controller.ProcessState}" Value="{x:Static watchers:Win32_ProcessWatcherProcessState.Exited}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <iconPacks:PackIconMaterial Kind="ShieldAccount" />
                </Button>

            </ToolBar>
        </ToolBarTray>
    </DataTemplate>
</ResourceDictionary>